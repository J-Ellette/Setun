<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setun - Ternary Computer Emulator</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>SETUN</h1>
            <p class="subtitle">Balanced Ternary Computer</p>
        </header>

        <div class="main-grid">
            <!-- Left Panel: Editor and Controls -->
            <div class="editor-panel">
                <div class="card">
                    <div class="card-header">
                        <h2>Program Editor</h2>
                        <div class="editor-controls">
                            <select id="examplesSelect" class="examples-dropdown">
                                <option value="">Load Example...</option>
                            </select>
                            <button id="saveBtn" class="btn btn-secondary" title="Save Program">
                                <span class="icon">üíæ</span>
                            </button>
                            <button id="exportMemoryBtn" class="btn btn-secondary" title="Export Memory State">
                                <span class="icon">üì§</span>
                            </button>
                            <button id="importMemoryBtn" class="btn btn-secondary" title="Import Memory State">
                                <span class="icon">üì•</span>
                            </button>
                            <input type="file" id="importMemoryFile" accept=".json" style="display: none;">
                        </div>
                    </div>
                    <div class="code-editor-wrapper">
                        <div class="line-numbers" id="lineNumbers"></div>
                        <textarea id="programEditor" class="program-editor" placeholder="Enter your Setun program here...
Use balanced ternary: - (minus/‚àí1), 0 (zero), + (plus/+1)
Example: +0- means +1, 0, -1" spellcheck="false"></textarea>
                        <div class="syntax-highlight-overlay" id="syntaxHighlight"></div>
                        <div id="autocomplete" class="autocomplete-dropdown hidden"></div>
                    </div>
                    <div id="syntaxError" class="error-message hidden"></div>
                </div>

                <div class="card controls-card">
                    <h2>Execution Controls</h2>
                    <div class="controls-group">
                        <button id="runBtn" class="btn btn-primary" title="Run Program">
                            <span class="icon">‚ñ∂</span> Run
                        </button>
                        <button id="stepBtn" class="btn btn-primary" title="Step One Instruction">
                            <span class="icon">‚Üí</span> Step
                        </button>
                        <button id="stepBackBtn" class="btn btn-primary" title="Step Back (Undo Last Instruction)">
                            <span class="icon">‚Üê</span> Back
                        </button>
                        <button id="pauseBtn" class="btn btn-warning hidden" title="Pause Execution">
                            <span class="icon">‚è∏</span> Pause
                        </button>
                        <button id="resetBtn" class="btn btn-secondary" title="Reset Computer">
                            <span class="icon">‚Üª</span> Reset
                        </button>
                    </div>
                    <div class="speed-control">
                        <label for="speedSlider">Speed:</label>
                        <input type="range" id="speedSlider" min="1" max="10" value="5" class="slider">
                        <span id="speedLabel">5x</span>
                    </div>
                    <div class="status-bar">
                        <span class="label">Status:</span>
                        <span id="statusBadge" class="badge badge-idle">Idle</span>
                        <span id="instructionCount" class="instruction-count">Instructions: 0</span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Visualization -->
            <div class="visualization-panel">
                <div class="card">
                    <h2>Registers</h2>
                    <div class="registers-grid">
                        <div class="register-item" id="registerACC">
                            <div class="register-label">Accumulator</div>
                            <div class="register-value">
                                <span class="ternary-value">0</span>
                                <span class="decimal-value">(0)</span>
                            </div>
                        </div>
                        <div class="register-item" id="registerPC">
                            <div class="register-label">Program Counter</div>
                            <div class="register-value">
                                <span class="ternary-value">0</span>
                                <span class="decimal-value">(0)</span>
                            </div>
                        </div>
                        <div class="register-item" id="registerIR">
                            <div class="register-label">Instruction Register</div>
                            <div class="register-value">
                                <span class="ternary-value">0</span>
                                <span class="decimal-value">(0)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2>Call Stack</h2>
                    <div class="call-stack-viewer" id="callStackViewer">
                        <div class="empty-state">Empty</div>
                    </div>
                </div>

                <div class="card">
                    <h2>Breakpoints</h2>
                    <div class="breakpoint-controls">
                        <input type="number" id="breakpointAddress" placeholder="Address" min="0" class="breakpoint-input">
                        <button id="addBreakpointBtn" class="btn btn-secondary btn-small">Add</button>
                        <button id="clearBreakpointsBtn" class="btn btn-secondary btn-small">Clear All</button>
                    </div>
                    <div class="breakpoint-list" id="breakpointList">
                        <div class="empty-state">No breakpoints</div>
                    </div>
                    
                    <h3 style="margin-top: 16px; font-size: 14px;">Conditional</h3>
                    <div class="conditional-breakpoint-controls">
                        <select id="conditionType" class="condition-select">
                            <option value="accumulator">Accumulator</option>
                            <option value="memory">Memory</option>
                        </select>
                        <input type="number" id="conditionAddress" placeholder="Addr" class="condition-input" disabled>
                        <select id="conditionOperator" class="condition-select">
                            <option value="==">==</option>
                            <option value="!=">!=</option>
                            <option value=">">></option>
                            <option value="<"><</option>
                            <option value=">=">>=</option>
                            <option value="<="><=</option>
                        </select>
                        <input type="number" id="conditionValue" placeholder="Value" class="condition-input">
                        <button id="addConditionBtn" class="btn btn-secondary btn-small">Add</button>
                    </div>
                    <div class="conditional-breakpoint-list" id="conditionalBreakpointList">
                        <div class="empty-state">No conditions</div>
                    </div>
                </div>

                <div class="card">
                    <h2>Watch Expressions</h2>
                    <div class="watch-controls">
                        <select id="watchType" class="watch-type-select">
                            <option value="accumulator">Accumulator</option>
                            <option value="memory">Memory</option>
                        </select>
                        <input type="number" id="watchAddress" placeholder="Address" class="watch-input" disabled>
                        <input type="text" id="watchLabel" placeholder="Label" class="watch-input">
                        <button id="addWatchBtn" class="btn btn-secondary btn-small">Add</button>
                    </div>
                    <div class="watch-list" id="watchList">
                        <div class="empty-state">No watches</div>
                    </div>
                    <div class="watch-info">
                        <span id="historyStatus">History: <strong id="historySize">0</strong> states</span>
                    </div>
                </div>

                <div class="card">
                    <div class="tabs">
                        <button class="tab-btn active" data-tab="memory">Memory</button>
                        <button class="tab-btn" data-tab="help">Help</button>
                    </div>
                    <div class="memory-controls">
                        <label for="memoryViewMode">View:</label>
                        <select id="memoryViewMode" class="view-mode-select">
                            <option value="ternary">Ternary</option>
                            <option value="decimal">Decimal</option>
                            <option value="hex">Hexadecimal</option>
                            <option value="mixed" selected>Mixed</option>
                        </select>
                        <label for="memorySizeSelect">Size:</label>
                        <select id="memorySizeSelect" class="memory-size-select">
                            <option value="27">27</option>
                            <option value="81" selected>81</option>
                            <option value="243">243</option>
                        </select>
                    </div>
                    <div class="memory-protection-controls">
                        <input type="number" id="protectStart" placeholder="Start" class="protect-input" min="0">
                        <input type="number" id="protectEnd" placeholder="End" class="protect-input" min="0">
                        <button id="protectBtn" class="btn btn-secondary btn-small">Protect</button>
                        <button id="unprotectBtn" class="btn btn-secondary btn-small">Unprotect</button>
                        <button id="clearProtectionBtn" class="btn btn-secondary btn-small">Clear All</button>
                    </div>
                    <div class="memory-heatmap-controls">
                        <button id="toggleHeatmapBtn" class="btn btn-secondary btn-small">üî• Heatmap: OFF</button>
                        <button id="clearHeatmapBtn" class="btn btn-secondary btn-small">Clear Heatmap</button>
                    </div>
                    
                    <div id="memoryTab" class="tab-content active">
                        <div class="memory-viewer" id="memoryViewer">
                            <!-- Memory cells will be dynamically populated -->
                        </div>
                    </div>
                    
                    <div id="helpTab" class="tab-content hidden">
                        <div class="help-content">
                            <h3>Balanced Ternary</h3>
                            <p>Setun uses balanced ternary: <strong>‚àí</strong> (‚àí1), <strong>0</strong> (0), <strong>+</strong> (+1)</p>
                            
                            <h3>Instructions</h3>
                            <ul>
                                <li><strong>0:</strong> HALT - Stop execution</li>
                                <li><strong>+:</strong> ADD - Add next value to accumulator</li>
                                <li><strong>‚àí:</strong> SUB - Subtract next value from accumulator</li>
                                <li><strong>+‚àí:</strong> LOAD - Load from memory address</li>
                                <li><strong>‚àí+:</strong> STORE - Store to memory address</li>
                                <li><strong>+0:</strong> JMP - Unconditional jump</li>
                                <li><strong>++:</strong> JZ - Jump if zero</li>
                                <li><strong>‚àí‚àí:</strong> JNZ - Jump if not zero</li>
                                <li><strong>+‚àí‚àí:</strong> JNP - Jump if positive</li>
                                <li><strong>+‚àí0:</strong> SHL - Shift left (√ó3)</li>
                                <li><strong>‚àí+0:</strong> SHR - Shift right (√∑3)</li>
                                <li><strong>+‚àí+:</strong> CALL - Call subroutine</li>
                                <li><strong>‚àí+‚àí:</strong> RET - Return from subroutine</li>
                                <li><strong>+0‚àí:</strong> NEG - Negate accumulator</li>
                                <li><strong>+00:</strong> INC - Increment accumulator</li>
                                <li><strong>‚àí00:</strong> DEC - Decrement accumulator</li>
                            </ul>
                            
                            <h3>Controls</h3>
                            <ul>
                                <li><strong>Run:</strong> Execute program continuously <kbd>F5</kbd></li>
                                <li><strong>Step:</strong> Execute one instruction <kbd>F10</kbd></li>
                                <li><strong>Pause:</strong> Pause running program <kbd>F8</kbd></li>
                                <li><strong>Reset:</strong> Clear all state <kbd>Ctrl+R</kbd></li>
                                <li><strong>Save:</strong> Save program to browser <kbd>Ctrl+S</kbd></li>
                                <li><strong>Toggle Breakpoint:</strong> At cursor line <kbd>F9</kbd></li>
                            </ul>
                            
                            <h3>Editor Features</h3>
                            <ul>
                                <li><strong>Autocomplete:</strong> Type instruction names for suggestions</li>
                                <li><strong>Line Numbers:</strong> Click numbers to view</li>
                                <li><strong>Code Folding:</strong> Use <code>; FOLD</code> and <code>; ENDFOLD</code> markers</li>
                                <li><strong>Error Indicators:</strong> Hover over ‚ö† for details</li>
                            </ul>
                            
                            <h3>Example Programs</h3>
                            <p>Select from the dropdown to load example programs demonstrating the instruction set.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="setun.js"></script>
    <script src="app.js"></script>
</body>
</html>
